# Folder JSON Builder — краткое руководство

## Что это
Скрипт Google Apps Script, который обходит папку на Google Drive рекурсивно и формирует JSON-снимок со всеми файлами и подпапками (в формате, похожем на наш образец).

## Где лежат файлы в репозитории
- Код (для хранения версии):  
  `backend/tools/folder_json_builder.gs`
- Это руководство:  
  `docs/manuals/folder_json_builder_manual.md`

> Важно: `.gs` не выполняется локально. Скрипт запускается в **Google Apps Script** в вашем аккаунте Google.

---

## Подготовка
1. Откройте нужную папку Google Drive в браузере и скопируйте её **ID**  
   (например, из `https://drive.google.com/drive/folders/<ID>`).
2. Зайдите на **https://script.google.com** → **Новый проект**.

---

## Установка скрипта
1. В редакторе Apps Script удалите заготовку `Code.gs` и **вставьте содержимое** файла из репозитория  
   `backend/tools/folder_json_builder.gs`.
2. Вверху файла найдите строку:
   ```js
   const ROOT_FOLDER_ID = '...';
   ```
   и подставьте ID вашей папки на Drive.
3. При необходимости отрегулируйте:
   ```js
   const MAX_DEPTH = 20; // максимальная глубина вложенности
   ```
4. Сохраните проект (задайте имя, например **Folder JSON Builder**).

---

## Запуск
1. В выпадающем списке функций выберите **exportJson** → **Выполнить**.  
2. На первом запуске подтвердите доступ к Google Drive (Apps Script попросит авторизацию).
3. Скрипт создаст файл вида  
   **`drive_snapshot_YYYY-MM-DD.json`** **в этой же папке Google Drive**, ID которой вы указали.
4. Скачайте JSON или перенесите его в репозиторий (например, в `docs/gdrive/`).

---

## Автозапуск по расписанию (опционально)
1. В редакторе Apps Script слева **Триггеры** → **Создать триггер**.  
2. Функция: `exportJson` → Источник: **Время** → период (ежедневно/еженедельно) → Сохранить.

---

## Формат вывода (сокращённо)
```json
{
  "folder_name": "AI HR",
  "folder_id": "xxxxxxxxxxxxxxxx",
  "total_file_count": 29,
  "files_reviewed_count": 29,
  "contents": [
    {
      "type": "file",
      "title": "Документ.pdf",
      "file_chip_id": "[Документ.pdf](https://drive.google.com/open?id=....)",
      "id": "....",
      "mime_type": "application/pdf",
      "created_time": "2025-09-18T09:12:34.000Z",
      "modified_time": "2025-09-18T10:01:02.000Z"
    },
    {
      "type": "folder",
      "title": "Подпапка",
      "folder_id": "....",
      "file_chip_id": "[Подпапка](https://drive.google.com/drive/folders/....)",
      "summary": { "total_file_count": 7, "files_reviewed_count": 7 },
      "contents": [ /* элементы подпапки */ ]
    }
  ]
}
```

---

## Частые вопросы
- **Почему хранить `.gs` в репо, если он запускается в облаке?**  
  Для версионирования и прозрачности. В Apps Script вы просто копируете актуальную версию из репозитория.
- **Можно ли сохранять JSON в другое место?**  
  Да — замените строку создания файла; по умолчанию сохраняем **в ту же папку**, которую сканируем.
- **Нет доступа к подпапкам?**  
  Проверьте, что у вашего аккаунта есть права на все вложенные элементы.

---

## Быстрый чек-лист
1. Вставить код из `backend/tools/folder_json_builder.gs` в Apps Script.  
2. Прописать `ROOT_FOLDER_ID`.  
3. Запустить `exportJson` → авторизоваться.  
4. Полученный `drive_snapshot_*.json` положить в `docs/gdrive/` (или скачать локально).
